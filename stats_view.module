<?php
// $Id$

/**
 * @file
 * Display usage statistics in various places
 * @author BÃ¨r Kessels <ber@webschuur.com>
 * @link http://wizzlern.nl
 * @package stats_view
 */

/* -----------------------------------------------------------------
  Hook Implementations
------------------------------------------------------------------ */
/**
 * Implementation of hook_menu().
 */
function stats_view_menu() {
  $items = array();

  $items['stats_view'] = array(
    'title' => 'Bekijk statistieken',
    'page callback' => 'stats_view_list',
    'access arguments' => array('access administration pages'), //Komen we later op terug.
  );
  
  $items['admin/settings/stats_view'] = array(
    'title' => 'Stats view configuration',
    'page callback' => 'stats_view_settings',
    'access arguments' => array('access administration pages'), //Komen we later op terug.
  );

  return $items;
}

/**
 * Callback for hook_menu().
 * 'page callback' => 'stats_view_list' causes this function to be ran
 * for output on the page /stats_view.
 */
function stats_view_list() {
  return 'Hier komt de lijst met recente logs';
}


/** 
 * Builds the HTML of a settings-form.
 * Callback for hook_menu().
 *
 * @return
 *   string HTML for settings form
 */
function stats_view_settings() {
  return drupal_get_form('stats_view_settings_form');
}

/**
 * Callback for drupal_get_form in stats_view_settings.
 */
function stats_view_settings_form() {
//print_r($form_state);
//var_dump($form_state);
//dpr($form_state);
  $form['stats_view_amount_entries'] = array(
    '#type' => 'textfield',
    '#title' => 'Amount of entries to show',
    '#description' => 'Provide the amount of statistics-entries that you want to show in the block with the articles.',
    '#default_value' => variable_get('stats_view_amount_entries', 5),
    '#weight' => -100,
  );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => t('Save'),
  );

  return $form;
}

/**
 * Validation callback for stats_view_settings form.
 */
function stats_view_settings_form_validate($form, &$form_state) {
  //print_r($form_state);
  if (!(int)$form_state['values']['stats_view_amount_entries']) {
    form_set_error('stats_view_amount_entries', 'amount must be a round number');
  }
  elseif ($form_state['values']['stats_view_amount_entries'] <= 0) {
    form_set_error('stats_view_amount_entries', 'amount must be greater then 0');
  }
}

/**
 * Validation callback for stats_view_settings form.
 */
function stats_view_settings_form_submit($form, &$form_state) {
  variable_set('stats_view_amount_entries', (int)$form_state['values']['stats_view_amount_entries']);
}

